# Semana 11: Operaciones de Agregar, Agrupar y Fusionar en Pandas - Actividad Pr√°ctica

## üéØ Instrucciones de la Actividad

### üìã Objetivo
Desarrollar habilidades avanzadas en las operaciones fundamentales de Pandas para combinar y manipular DataFrames, dominando el uso de `concat()`, `groupby()`, `merge()` y `join()` para realizar an√°lisis de datos complejos con m√∫ltiples fuentes de informaci√≥n.

### üîß Configuraci√≥n del Entorno

#### 1. Fork del Repositorio
1. **Hacer Fork**: Haz clic en el bot√≥n "Fork" en la esquina superior derecha de este repositorio

```
https://github.com/jfinfocesde/act_ntp_s11.git
```  
2. **Clonar tu Fork**: Clona tu repositorio fork a tu m√°quina local
   ```bash
   git clone https://github.com/TU_USUARIO/act_ntp_s11.git
   cd act_ntp_s11
   ```

#### 2. Instalaci√≥n de Dependencias
```bash
pip install pandas numpy matplotlib
```

#### 3. Estructura del Proyecto
```
act_ntp_s11/
‚îú‚îÄ‚îÄ README.md              # Este archivo con instrucciones
‚îú‚îÄ‚îÄ activities.json        # Lista de ejercicios
‚îú‚îÄ‚îÄ evaluations.json       # Criterios de evaluaci√≥n
‚îú‚îÄ‚îÄ info.json             # Informaci√≥n del proyecto
‚îî‚îÄ‚îÄ src/                  # Carpeta para tus soluciones
    ‚îú‚îÄ‚îÄ ejercicio_01.py   # Ejercicio 1 - concat b√°sico
    ‚îú‚îÄ‚îÄ ejercicio_02.py   # Ejercicio 2 - concat con keys
    ‚îú‚îÄ‚îÄ ejercicio_03.py   # Ejercicio 3 - concat horizontal
    ‚îú‚îÄ‚îÄ ejercicio_04.py   # Ejercicio 4 - groupby b√°sico
    ‚îú‚îÄ‚îÄ ejercicio_05.py   # Ejercicio 5 - groupby agregaciones m√∫ltiples
    ‚îú‚îÄ‚îÄ ejercicio_06.py   # Ejercicio 6 - groupby con transform
    ‚îú‚îÄ‚îÄ ejercicio_07.py   # Ejercicio 7 - groupby con fechas
    ‚îú‚îÄ‚îÄ ejercicio_08.py   # Ejercicio 8 - merge inner join
    ‚îú‚îÄ‚îÄ ejercicio_09.py   # Ejercicio 9 - merge m√∫ltiples tipos
    ‚îî‚îÄ‚îÄ ejercicio_10.py   # Ejercicio 10 - proyecto integrador
```

## üöÄ Ejercicios a Resolver

### üìä DataFrame Base para Todos los Ejercicios

Todos los ejercicios trabajar√°n con un DataFrame unificado que simula un sistema de gesti√≥n empresarial. Este DataFrame se genera completamente por c√≥digo:

```python
import pandas as pd
import numpy as np
from datetime import datetime, timedelta
import matplotlib.pyplot as plt

# Configurar semilla para reproducibilidad
np.random.seed(42)

def crear_dataset_empresarial():
    """
    Crea un dataset empresarial completo con todas las tablas necesarias
    para los ejercicios de concat, groupby y merge.
    """
    
    # DataFrame principal de transacciones de ventas
    n_ventas = 200
    ventas = pd.DataFrame({
        'venta_id': range(1, n_ventas + 1),
        'empleado_id': np.random.randint(1, 21, n_ventas),
        'producto_id': np.random.randint(1, 16, n_ventas),
        'departamento_id': np.random.randint(1, 6, n_ventas),
        'cantidad': np.random.randint(1, 10, n_ventas),
        'precio_unitario': np.random.randint(50, 1000, n_ventas),
        'descuento': np.random.uniform(0, 0.3, n_ventas),
        'fecha_venta': [
            datetime(2023, 1, 1) + timedelta(days=np.random.randint(0, 730))
            for _ in range(n_ventas)
        ],
        'a√±o': np.random.choice([2023, 2024], n_ventas),
        'trimestre': np.random.randint(1, 5, n_ventas),
        'region': np.random.choice(['Norte', 'Centro', 'Sur'], n_ventas)
    })
    
    # Calcular columnas derivadas
    ventas['total_bruto'] = ventas['cantidad'] * ventas['precio_unitario']
    ventas['total_neto'] = ventas['total_bruto'] * (1 - ventas['descuento'])
    
    # DataFrame de empleados
    empleados = pd.DataFrame({
        'empleado_id': range(1, 21),
        'nombre': [f'Empleado_{i}' for i in range(1, 21)],
        'apellido': [f'Apellido_{i}' for i in range(1, 21)],
        'departamento_id': np.random.randint(1, 6, 20),
        'salario': np.random.randint(40000, 150000, 20),
        'fecha_ingreso': [
            datetime(2020, 1, 1) + timedelta(days=np.random.randint(0, 1460))
            for _ in range(20)
        ],
        'activo': np.random.choice([True, False], 20, p=[0.9, 0.1]),
        'edad': np.random.randint(25, 60, 20)
    })
    
    # DataFrame de productos
    productos = pd.DataFrame({
        'producto_id': range(1, 16),
        'nombre_producto': [f'Producto_{i}' for i in range(1, 16)],
        'categoria': np.random.choice(['Electr√≥nicos', 'Ropa', 'Hogar', 'Deportes'], 15),
        'precio_base': np.random.randint(30, 800, 15),
        'costo': np.random.randint(15, 400, 15),
        'stock': np.random.randint(10, 100, 15)
    })
    
    # DataFrame de departamentos
    departamentos = pd.DataFrame({
        'departamento_id': range(1, 6),
        'nombre_dept': ['Ventas', 'Marketing', 'IT', 'RRHH', 'Finanzas'],
        'presupuesto': [500000, 300000, 800000, 200000, 600000],
        'ubicacion': ['Piso 1', 'Piso 2', 'Piso 3', 'Piso 1', 'Piso 2']
    })
    
    return ventas, empleados, productos, departamentos

# Crear los DataFrames
ventas, empleados, productos, departamentos = crear_dataset_empresarial()

# Mostrar informaci√≥n b√°sica
print("=== INFORMACI√ìN DEL DATASET ===")
print(f"Ventas: {len(ventas)} registros")
print(f"Empleados: {len(empleados)} registros")
print(f"Productos: {len(productos)} registros")
print(f"Departamentos: {len(departamentos)} registros")
```

**Estructura de los DataFrames:**

- **ventas**: Transacciones de ventas (200 registros) con informaci√≥n completa de cada venta
- **empleados**: Informaci√≥n de empleados (20 registros) con datos personales y laborales
- **productos**: Cat√°logo de productos (15 registros) con precios y categor√≠as
- **departamentos**: Informaci√≥n de departamentos (5 registros) con presupuestos y ubicaciones

---

## üìù EJERCICIOS PR√ÅCTICOS (10 Ejercicios)

### **Ejercicio 1: Concatenaci√≥n B√°sica Vertical** üîó
**Tema:** Operaciones de Concatenaci√≥n con `concat()`

Implementa una funci√≥n que divida el DataFrame de ventas por a√±o y luego los concatene nuevamente. La funci√≥n debe:

- Dividir las ventas en DataFrames separados por a√±o (2023 y 2024)
- Concatenar verticalmente usando `pd.concat()`
- Resetear el √≠ndice para evitar duplicados
- Verificar que no haya p√©rdida de datos
- Mostrar estad√≠sticas antes y despu√©s de la concatenaci√≥n

**Archivo:** `src/ejercicio_01.py`

**C√≥digo base:**
```python
def concatenacion_basica(ventas_df):
    """
    Divide las ventas por a√±o y las concatena nuevamente
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 2: Concatenaci√≥n con Identificadores** üè∑Ô∏è
**Tema:** Concatenaci√≥n con `keys` para crear √≠ndices jer√°rquicos

Crea una funci√≥n que use `concat()` con keys para identificar el origen de los datos. La funci√≥n debe:

- Dividir las ventas por regi√≥n (Norte, Centro, Sur)
- Concatenar con keys para crear un √≠ndice jer√°rquico
- Mostrar c√≥mo acceder a datos espec√≠ficos por regi√≥n
- Calcular totales por regi√≥n usando el √≠ndice jer√°rquico

**Archivo:** `src/ejercicio_02.py`

**C√≥digo base:**
```python
def concatenacion_con_keys(ventas_df):
    """
    Concatena ventas por regi√≥n con identificadores
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 3: Concatenaci√≥n Horizontal** ‚ÜîÔ∏è
**Tema:** Concatenaci√≥n horizontal con `axis=1`

Desarrolla una funci√≥n que combine DataFrames horizontalmente. La funci√≥n debe:

- Dividir el DataFrame de empleados en informaci√≥n personal (nombre, apellido, edad) e informaci√≥n laboral (salario, departamento, activo)
- Concatenar horizontalmente usando `concat()` con `axis=1`
- Manejar √≠ndices que coinciden
- Verificar la integridad de los datos combinados

**Archivo:** `src/ejercicio_03.py`

**C√≥digo base:**
```python
def concatenacion_horizontal(empleados_df):
    """
    Divide y concatena horizontalmente informaci√≥n de empleados
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 4: Agrupaci√≥n B√°sica** üìä
**Tema:** Operaciones b√°sicas con `groupby()`

Implementa una funci√≥n que use `groupby()` para an√°lisis b√°sicos. La funci√≥n debe:

- Agrupar ventas por departamento
- Calcular estad√≠sticas b√°sicas (count, mean, sum, std) del total_neto
- Agrupar empleados por departamento y calcular salario promedio
- Mostrar los resultados de forma clara y organizada

**Archivo:** `src/ejercicio_04.py`

**C√≥digo base:**
```python
def agrupacion_basica(ventas_df, empleados_df):
    """
    Realiza agrupaciones b√°sicas por departamento
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 5: Agregaciones M√∫ltiples** üî¢
**Tema:** M√∫ltiples agregaciones con `agg()`

Crea una funci√≥n que aplique m√∫ltiples agregaciones simult√°neamente. La funci√≥n debe:

- Usar `agg()` con m√∫ltiples funciones en una sola operaci√≥n
- Aplicar diferentes agregaciones a diferentes columnas
- Crear funciones de agregaci√≥n personalizadas (ej: rango = max - min)
- Formatear los resultados para mejor legibilidad

**Archivo:** `src/ejercicio_05.py`

**C√≥digo base:**
```python
def agregaciones_multiples(ventas_df):
    """
    Aplica m√∫ltiples agregaciones a las ventas
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 6: Transform - Mantener Estructura Original** üîÑ
**Tema:** Uso de `transform()` para mantener la forma original

Implementa una funci√≥n que use `transform()` para agregar columnas calculadas. La funci√≥n debe:

- Calcular el total promedio por departamento y agregarlo como nueva columna
- Calcular el ranking de ventas por empleado dentro de cada departamento
- Normalizar los totales de venta dentro de cada trimestre
- Comparar `transform()` vs `apply()` en t√©rminos de resultado

**Archivo:** `src/ejercicio_06.py`

**C√≥digo base:**
```python
def usar_transform(ventas_df):
    """
    Usa transform para agregar columnas calculadas
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 7: Agrupaci√≥n Temporal** üìÖ
**Tema:** Agrupaci√≥n por fechas y an√°lisis temporal

Implementa una funci√≥n que agrupe datos temporales. La funci√≥n debe:

- Agrupar ventas por mes y a√±o usando `pd.Grouper`
- Calcular tendencias mensuales de ventas
- Identificar el mes con mejores y peores ventas
- Crear un an√°lisis de estacionalidad b√°sico

**Archivo:** `src/ejercicio_07.py`

**C√≥digo base:**
```python
def agrupacion_temporal(ventas_df):
    """
    Agrupa ventas por per√≠odos temporales
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 8: Merge Inner Join** üîó
**Tema:** Fusi√≥n de DataFrames con `merge()` - Inner Join

Implementa una funci√≥n que use `merge()` con inner join. La funci√≥n debe:

- Fusionar ventas con empleados para obtener informaci√≥n completa
- Fusionar el resultado con productos para agregar detalles del producto
- Verificar que solo se mantengan registros con coincidencias
- Analizar qu√© datos se pierden en el proceso y por qu√©

**Archivo:** `src/ejercicio_08.py`

**C√≥digo base:**
```python
def merge_inner_join(ventas_df, empleados_df, productos_df):
    """
    Fusiona m√∫ltiples DataFrames usando inner join
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 9: Merge con M√∫ltiples Tipos de Join** üîÑ
**Tema:** Comparaci√≥n de diferentes tipos de join

Crea una funci√≥n que compare diferentes tipos de merge. La funci√≥n debe:

- Realizar inner, left, right y outer join entre ventas y empleados
- Comparar el n√∫mero de registros resultantes en cada caso
- Identificar registros hu√©rfanos en cada tipo de join
- Crear un reporte de integridad de datos para cada tipo

**Archivo:** `src/ejercicio_09.py`

**C√≥digo base:**
```python
def comparar_tipos_join(ventas_df, empleados_df):
    """
    Compara diferentes tipos de join y sus resultados
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

### **Ejercicio 10: Proyecto Integrador Final** üéØ
**Tema:** Combinaci√≥n de todas las operaciones aprendidas

Implementa una funci√≥n que combine todas las operaciones aprendidas en un an√°lisis empresarial completo. La funci√≥n debe:

- Concatenar datos de diferentes per√≠odos/regiones
- Agrupar y agregar m√©tricas por m√∫ltiples dimensiones
- Fusionar todos los DataFrames para crear un dataset maestro
- Crear un dashboard de m√©tricas empresariales con:
  - Top 5 empleados por ventas
  - An√°lisis de rendimiento por departamento
  - Productos m√°s vendidos por categor√≠a
  - Tendencias temporales de ventas
- Generar visualizaciones b√°sicas de los resultados
- Implementar validaciones y controles de calidad

**Archivo:** `src/ejercicio_10.py`

**C√≥digo base:**
```python
def proyecto_integrador(ventas_df, empleados_df, productos_df, departamentos_df):
    """
    An√°lisis empresarial completo usando todas las operaciones de Pandas
    """
    # Tu c√≥digo aqu√≠
    pass
```

---

## üìà Criterios de Evaluaci√≥n

### üéØ R√∫brica de Evaluaci√≥n (100 puntos)

#### **Operaciones de Concatenaci√≥n (30 puntos) - Ejercicios 1-3**
- **Excelente (26-30)**: Domina `concat()` en todas sus variantes, maneja √≠ndices y keys correctamente
- **Bueno (21-25)**: Usa `concat()` correctamente en casos b√°sicos, algunas dificultades con casos complejos
- **Regular (16-20)**: Entiende `concat()` b√°sico, errores en casos avanzados
- **Deficiente (0-15)**: No comprende las operaciones de concatenaci√≥n

#### **Operaciones de Agrupaci√≥n (40 puntos) - Ejercicios 4-7**
- **Excelente (36-40)**: Domina `groupby`, `agg`, `transform` con funciones personalizadas y an√°lisis temporal
- **Bueno (29-35)**: Usa `groupby` y agregaciones b√°sicas correctamente, dificultades con `transform`
- **Regular (22-28)**: Entiende `groupby` b√°sico, errores en agregaciones complejas
- **Deficiente (0-21)**: No comprende las operaciones de agrupaci√≥n

#### **Operaciones de Fusi√≥n (20 puntos) - Ejercicios 8-9**
- **Excelente (18-20)**: Domina `merge` en todos los tipos, maneja claves m√∫ltiples y validaciones
- **Bueno (15-17)**: Usa `merge` correctamente en casos b√°sicos, algunas dificultades con joins complejos
- **Regular (12-14)**: Entiende `merge` b√°sico, errores en tipos de join
- **Deficiente (0-11)**: No comprende las operaciones de fusi√≥n

#### **Proyecto Integrador y Calidad del C√≥digo (10 puntos) - Ejercicio 10**
- **Excelente (9-10)**: C√≥digo limpio, bien documentado, proyecto completo con validaciones
- **Bueno (7-8)**: C√≥digo funcional con documentaci√≥n b√°sica, proyecto mayormente completo
- **Regular (5-6)**: C√≥digo funcional pero poco documentado, proyecto parcial
- **Deficiente (0-4)**: C√≥digo dif√≠cil de entender, proyecto incompleto

---

## üìö Recursos Adicionales

### üìñ Documentaci√≥n Oficial
- [Pandas Merge Documentation](https://pandas.pydata.org/docs/user_guide/merging.html)
- [Pandas GroupBy Documentation](https://pandas.pydata.org/docs/user_guide/groupby.html)
- [Pandas Concatenation Documentation](https://pandas.pydata.org/docs/user_guide/merging.html#concatenating-objects)

### üé• Tutoriales Recomendados
- [Pandas GroupBy Tutorial](https://www.youtube.com/watch?v=qy0fDqoMJx8)
- [Pandas Merge and Join](https://www.youtube.com/watch?v=h4hOPGo4UVU)

### üìä Datasets de Pr√°ctica
- [Kaggle Datasets](https://www.kaggle.com/datasets)
- [UCI Machine Learning Repository](https://archive.ics.uci.edu/ml/index.php)

---

## üöÄ Entrega

### üìÖ Fecha L√≠mite
**Fecha de entrega:** [Especificar fecha]

### üìã Instrucciones de Entrega
1. **Completar todos los ejercicios** en los archivos correspondientes
2. **Documentar el c√≥digo** con comentarios explicativos
3. **Incluir validaciones** y manejo de errores
4. **Crear un README.md** con resumen de soluciones
5. **Hacer commit y push** al repositorio fork
6. **Crear Pull Request** al repositorio original

### ‚úÖ Checklist de Entrega
- [ ] Todos los 10 ejercicios completados
- [ ] C√≥digo documentado y comentado
- [ ] Validaciones implementadas
- [ ] README.md con resumen
- [ ] Pull Request creado
- [ ] C√≥digo ejecutable sin errores

---

## üí° Consejos para el √âxito

### üéØ Mejores Pr√°cticas
1. **Planifica antes de codificar**: Entiende qu√© operaci√≥n necesitas antes de escribir c√≥digo
2. **Valida tus datos**: Siempre verifica la integridad antes y despu√©s de las operaciones
3. **Documenta tus decisiones**: Explica por qu√© elegiste un tipo de join o agregaci√≥n
4. **Prueba con datos peque√±os**: Valida tu l√≥gica con subconjuntos antes de aplicar a todo el dataset
5. **Optimiza el rendimiento**: Considera el orden de las operaciones para mejor eficiencia

### üîß Herramientas √ötiles
- **Jupyter Notebooks**: Para experimentaci√≥n y prototipado
- **pandas.DataFrame.info()**: Para entender la estructura de tus datos
- **pandas.DataFrame.describe()**: Para estad√≠sticas r√°pidas
- **pandas.DataFrame.head()**: Para inspeccionar resultados

### üìä Distribuci√≥n de Ejercicios
- **Concatenaci√≥n (3 ejercicios)**: Fundamentos de combinaci√≥n vertical y horizontal
- **Agrupaci√≥n (4 ejercicios)**: An√°lisis agregado y transformaciones
- **Fusi√≥n (2 ejercicios)**: Combinaci√≥n de DataFrames relacionales
- **Integrador (1 ejercicio)**: Aplicaci√≥n completa de todos los conceptos

¬°√âxito en tu actividad pr√°ctica! üöÄ

