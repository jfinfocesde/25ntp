#  Semana 10 Filtros `.loc` y `.iloc`


## Version Google Colab

Este tutorial se puede ejecutar en Google Colab. Para abrir el notebook en Colab, haz clic en el siguiente enlace:

[Abrir en Colab](https://colab.research.google.com/drive/17cFE9yLHrShL5w42Yt335ZDeQkf7AVFs?usp=sharing){target = "_blank"}


Pandas es una biblioteca de Python ampliamente utilizada para el an谩lisis de datos. Los m茅todos **`.loc`** y **`.iloc`** permiten acceder a filas y columnas de un **DataFrame** de manera precisa. La principal diferencia entre ellos radica en c贸mo seleccionan los datos:

- **`.loc`**: Selecciona datos utilizando **etiquetas** (nombres de filas o columnas).
- **`.iloc`**: Selecciona datos utilizando **铆ndices num茅ricos** (posiciones enteras).

Ambos m茅todos son muy flexibles y admiten selecciones de filas, columnas o subconjuntos de datos, ya sea individuales, rangos o listas espec铆ficas.

---


## **1. Preparaci贸n del entorno**

Antes de comenzar, aseg煤rate de tener instalada la biblioteca **Pandas**. Si no la tienes, inst谩lala con:

```bash
pip install pandas
```

Carguemos un **DataFrame** de ejemplo para trabajar con 茅l:

```python
import pandas as pd

# Crear un DataFrame de ejemplo
data = {
    'Nombre': ['Ana', 'Bob', 'Clara', 'David', 'Emma'],
    'Edad': [25, 30, 22, 35, 28],
    'Ciudad': ['Madrid', 'Barcelona', 'Sevilla', 'Valencia', 'Bilbao'],
    'Puntuaci贸n': [85, 90, 88, 92, 87]
}

df = pd.DataFrame(data, index=['a', 'b', 'c', 'd', 'e'])
print(df)
```

**Salida:**

```
   Nombre  Edad     Ciudad  Puntuaci贸n
a    Ana    25    Madrid          85
b    Bob    30 Barcelona          90
c  Clara    22   Sevilla          88
d  David    35  Valencia          92
e   Emma    28    Bilbao          87
```

Este **DataFrame** tiene:
- **ndices** de filas: `'a', 'b', 'c', 'd', 'e'`.
- **Columnas**: `'Nombre', 'Edad', 'Ciudad', 'Puntuaci贸n'`.

Ahora, usaremos este **DataFrame** para explorar **`.loc`** y **`.iloc`**.

---

## **2. Uso de `.loc`**

El m茅todo **`.loc`** se basa en **etiquetas** (nombres de filas y columnas). Su sintaxis general es:

```python
df.loc[filas, columnas]
```

Donde:
- `filas`: Puede ser una etiqueta de 铆ndice, una lista de etiquetas, un rango de etiquetas (usando `:`) o una condici贸n booleana.
- `columnas`: Puede ser una etiqueta de columna, una lista de etiquetas o un rango de etiquetas.

### **2.1. Seleccionar una sola fila por etiqueta**

```python
# Seleccionar la fila con 铆ndice 'b'
print(df.loc['b'])
```

**Salida:**

```
Nombre            Bob
Edad               30
Ciudad      Barcelona
Puntuaci贸n         90
Name: b, dtype: object
```

Esto devuelve una **Serie** con los valores de la fila `'b'`.

### **2.2. Seleccionar una celda espec铆fica**

Puedes especificar tanto la fila como la columna:

```python
# Seleccionar la edad de la fila 'c'
print(df.loc['c', 'Edad'])
```

**Salida:**

```
22
```

### **2.3. Seleccionar m煤ltiples filas**

Puedes pasar una lista de etiquetas o un rango:

```python
# Seleccionar las filas 'a' y 'c'
print(df.loc[['a', 'c']])
```

**Salida:**

```
   Nombre  Edad   Ciudad  Puntuaci贸n
a    Ana    25  Madrid          85
c  Clara    22 Sevilla          88
```

Usando un rango:

```python
# Seleccionar filas desde 'a' hasta 'c' (inclusive)
print(df.loc['a':'c'])
```

**Salida:**

```
   Nombre  Edad     Ciudad  Puntuaci贸n
a    Ana    25    Madrid          85
b    Bob    30 Barcelona          90
c  Clara    22   Sevilla          88
```

**Nota**: En **`.loc`**, los rangos incluyen el valor final (a diferencia de los 铆ndices num茅ricos en Python).

### **2.4. Seleccionar columnas espec铆ficas**

Puedes seleccionar columnas espec铆ficas para una o m谩s filas:

```python
# Seleccionar 'Nombre' y 'Edad' de la fila 'b'
print(df.loc['b', ['Nombre', 'Edad']])
```

**Salida:**

```
Nombre    Bob
Edad       30
Name: b, dtype: object
```

### **2.5. Seleccionar con condiciones booleanas**

**`.loc`** es muy poderoso para filtrar filas basadas en condiciones:

```python
# Seleccionar filas donde la edad sea mayor a 25
print(df.loc[df['Edad'] > 25])
```

**Salida:**

```
   Nombre  Edad     Ciudad  Puntuaci贸n
b    Bob    30 Barcelona          90
d  David    35  Valencia          92
e   Emma    28    Bilbao          87
```

Puedes combinar condiciones:

```python
# Seleccionar filas donde Edad > 25 y Puntuaci贸n >= 90
print(df.loc[(df['Edad'] > 25) & (df['Puntuaci贸n'] >= 90)])
```

**Salida:**

```
   Nombre  Edad     Ciudad  Puntuaci贸n
b    Bob    30 Barcelona          90
d  David    35  Valencia          92
```

### **2.6. Modificar datos con `.loc`**

**`.loc`** tambi茅n permite modificar valores en el **DataFrame**:

```python
# Cambiar la puntuaci贸n de la fila 'a'
df.loc['a', 'Puntuaci贸n'] = 95
print(df.loc['a'])
```

**Salida:**

```
Nombre          Ana
Edad             25
Ciudad       Madrid
Puntuaci贸n       95
Name: a, dtype: object
```

---

## **3. Uso de `.iloc`**

El m茅todo **`.iloc`** se basa en **铆ndices num茅ricos** (posiciones enteras). Su sintaxis es similar:

```python
df.iloc[filas, columnas]
```

Donde:
- `filas`: Posiciones de las filas (0, 1, 2, ...).
- `columnas`: Posiciones de las columnas (0, 1, 2, ...).

### **3.1. Seleccionar una sola fila por posici贸n**

```python
# Seleccionar la fila en la posici贸n 1 (segunda fila)
print(df.iloc[1])
```

**Salida:**

```
Nombre            Bob
Edad               30
Ciudad      Barcelona
Puntuaci贸n         90
Name: b, dtype: object
```

### **3.2. Seleccionar una celda espec铆fica**

```python
# Seleccionar la celda en la fila 2, columna 1 (Edad de Clara)
print(df.iloc[2, 1])
```

**Salida:**

```
22
```

### **3.3. Seleccionar m煤ltiples filas**

Puedes usar listas o rangos de posiciones:

```python
# Seleccionar las filas en las posiciones 0 y 2
print(df.iloc[[0, 2]])
```

**Salida:**

```
   Nombre  Edad   Ciudad  Puntuaci贸n
a    Ana    25  Madrid          95
c  Clara    22 Sevilla          88
```

Usando un rango:

```python
# Seleccionar filas desde la posici贸n 0 hasta la 2 (excluye la 2)
print(df.iloc[0:2])
```

**Salida:**

```
  Nombre  Edad     Ciudad  Puntuaci贸n
a   Ana    25    Madrid          95
b   Bob    30 Barcelona          90
```

**Nota**: A diferencia de **`.loc`**, los rangos en **`.iloc`** excluyen el valor final, como es habitual en Python.

### **3.4. Seleccionar columnas espec铆ficas**

```python
# Seleccionar las columnas en las posiciones 0 y 2 para la fila 1
print(df.iloc[1, [0, 2]])
```

**Salida:**

```
Nombre          Bob
Ciudad    Barcelona
Name: b, dtype: object
```

### **3.5. Seleccionar un subconjunto de filas y columnas**

```python
# Seleccionar las primeras 3 filas y las primeras 2 columnas
print(df.iloc[0:3, 0:2])
```

**Salida:**

```
   Nombre  Edad
a    Ana    25
b    Bob    30
c  Clara    22
```

### **3.6. Modificar datos con `.iloc`**

Al igual que **`.loc`**, puedes modificar valores:

```python
# Cambiar la edad en la fila 0
df.iloc[0, 1] = 26
print(df.iloc[0])
```

**Salida:**

```
Nombre          Ana
Edad             26
Ciudad       Madrid
Puntuaci贸n       95
Name: a, dtype: object
```

---

## **4. Diferencias clave entre `.loc` y `.iloc`**

| Caracter铆stica             | `.loc`                              | `.iloc`                             |
|----------------------------|-------------------------------------|-------------------------------------|
| **Selecci贸n basada en**    | Etiquetas (nombres)                | ndices num茅ricos (posiciones)      |
| **Rangos**                | Incluye el valor final             | Excluye el valor final             |
| **Uso t铆pico**             | Cuando conoces los nombres de filas/columnas | Cuando trabajas con posiciones      |
| **Condiciones booleanas**  | Compatible                        | No compatible                      |

---

## **5. Errores comunes y c贸mo evitarlos**

1. **Error de 铆ndice en `.loc`**:
   - Si usas una etiqueta que no existe, obtendr谩s un **KeyError**:
     ```python
     df.loc['z']  # Error: 'z' no es un 铆ndice
     ```
   - **Soluci贸n**: Verifica las etiquetas con `df.index` o `df.columns`.

2. **Error de 铆ndice en `.iloc`**:
   - Si usas un 铆ndice fuera de rango, obtendr谩s un **IndexError**:
     ```python
     df.iloc[10]  # Error: 铆ndice 10 no existe
     ```
   - **Soluci贸n**: Usa `df.shape` para conocer las dimensiones del **DataFrame**.

3. **Confundir `.loc` con `.iloc`**:
   - Usar etiquetas con **`.iloc`** o 铆ndices num茅ricos con **`.loc`** causar谩 errores:
     ```python
     df.loc[0]    # Error si el 铆ndice no es 0
     df.iloc['a'] # Error: iloc no acepta etiquetas
     ```
   - **Soluci贸n**: Recuerda que **`.loc`** usa etiquetas y **`.iloc`** usa posiciones.

4. **Modificar vistas en lugar de copias**:
   - Al usar **`.loc`** o **`.iloc`** para seleccionar un subconjunto y modificarlo, puedes encontrarte con un **SettingWithCopyWarning** si no tienes cuidado:
     ```python
     subset = df.loc[df['Edad'] > 25]
     subset['Edad'] = 0  # Puede causar advertencia
     ```
   - **Soluci贸n**: Usa `.copy()` para crear una copia expl铆cita:
     ```python
     subset = df.loc[df['Edad'] > 25].copy()
     subset['Edad'] = 0
     ```

---

## Actividad 4: Creaci贸n de una aplicaci贸n interactiva con Streamlit utilizando .loc y .iloc

Desarrollar una aplicaci贸n web interactiva utilizando **Streamlit** que permita a los usuarios explorar y manipular un **DataFrame** de Pandas, haciendo uso intensivo de los m茅todos **`.loc`** y **`.iloc`** para realizar selecciones, filtros y modificaciones de datos. La tem谩tica y el dise帽o de la aplicaci贸n son libres, permitiendo expresar su creatividad.


**Instrucciones generales**:

- Desarrolar la actividad en el archivo _M2_Actividad_4.py del proyecto integrador.